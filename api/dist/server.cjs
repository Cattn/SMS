(()=>{"use strict";var e={252:e=>{e.exports=require("express")},296:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFile=t.getFiles=void 0;const o=s(r(928)),n=s(r(896));t.getFiles=async(e,t)=>{try{const e=o.default.join(process.cwd(),"../uploads"),r=n.default.readdirSync(e).map((t=>{const r=o.default.join(e,t);return{name:t,size:n.default.statSync(r).size}}));t.json({files:r})}catch{t.status(500).json({error:"Unable to read uploads directory"})}},t.getFile=async(e,t)=>{const r=o.default.join(process.cwd(),"../uploads",e.params.filename);t.sendFile(r)}},376:e=>{e.exports=require("express-fileupload")},498:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.errorHandler=void 0,t.errorHandler=(e,t,r)=>{console.error(e),r.status(e.status||500).json({message:e.message||"Internal Server Error"})}},516:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.progressStore=void 0,t.progressStore=new class{constructor(){this.store=new Map}setProgress(e,t,r){this.store.set(e,{token:e,progress:t,filename:r,timestamp:Date.now()})}getProgress(e){return this.store.get(e)}deleteProgress(e){this.store.delete(e)}cleanup(){const e=Date.now()-36e5;for(const[t,r]of this.store.entries())r.timestamp<e&&this.store.delete(t)}},setInterval((()=>t.progressStore.cleanup()),18e5)},720:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFile=void 0;const o=s(r(928)),n=r(516);t.uploadFile=async(e,t)=>{if(!e.files||0===Object.keys(e.files).length)return void t.status(400).send("No files were uploaded.");const r=e.files.file,s=e.body.uploadToken;if(!s)return void t.status(400).send("Upload token is required.");const a=o.default.join(process.cwd(),"../uploads",r.name);n.progressStore.setProgress(s,0,r.name);let l=0;const i=setInterval((()=>{l+=8*Math.random()+3,l<85&&n.progressStore.setProgress(s,Math.min(l,85),r.name)}),150);r.mv(a,(e=>{if(clearInterval(i),e)return n.progressStore.setProgress(s,-1),void t.status(500).send(e);n.progressStore.setProgress(s,100,r.name),setTimeout((()=>{n.progressStore.deleteProgress(s)}),2e3),t.json({message:"File uploaded successfully",filename:r.name})}))}},721:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getUploadProgress=void 0;const s=r(516);t.getUploadProgress=(e,t)=>{const{token:r}=e.params;if(!r)return void t.status(400).send("Upload token is required");t.writeHead(200,{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Cache-Control"});const o=s.progressStore.getProgress(r);o&&t.write(`data: ${JSON.stringify(o)}\n\n`);let n=0;const a=setInterval((()=>{const e=s.progressStore.getProgress(r);if(!e)return n++,void(n>=40&&(t.write(`data: ${JSON.stringify({progress:-1,error:"Upload not found"})}\n\n`),clearInterval(a),t.end()));n=0,t.write(`data: ${JSON.stringify(e)}\n\n`),(e.progress>=100||e.progress<0)&&(clearInterval(a),t.end())}),250);e.on("close",(()=>{clearInterval(a),t.end()}))}},839:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=(0,r(252).Router)(),o=r(720),n=r(296),a=r(721);s.post("/upload",o.uploadFile),s.get("/getFiles",n.getFiles),s.get("/getFile/:filename",n.getFile),s.get("/upload-progress/:token",a.getUploadProgress),t.default=s},896:e=>{e.exports=require("fs")},903:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(252)),n=s(r(839)),a=r(498),l=s(r(376)),i=(0,o.default)();i.use(o.default.json()),i.use((0,l.default)()),i.use("/api/",n.default),i.use(a.errorHandler),t.default=i},905:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});s(r(903)).default.listen(5823,(()=>{console.log("Server running on port 5823")}))},928:e=>{e.exports=require("path")}},t={};!function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}(905)})();